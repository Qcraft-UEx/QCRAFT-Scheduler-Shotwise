<p align="center">
   <picture>
     <source media="(prefers-color-scheme: dark)" srcset="https://github.com/Qcraft-UEx/Qcraft/blob/main/docs/_images/qcraft_logo.png?raw=true" width="60%">
     <img src="https://github.com/Qcraft-UEx/Qcraft/blob/main/docs/_images/qcraft_logo.png?raw=true" width="60%" alt="Qcraft Logo">
   </picture>
  </a>
</p>



# QCRAFT Scheduler-Shotwise
QCRAFT Scheduler-Shotwise: A tool to optimize the scheduling of quantum tasks in quantum computing environments by combining quantum circuits. 

The scheduler has the following main functions:

1. **Circuit Reception:** Users submit their quantum circuits to the scheduler for execution. Each user specifies the number of shots required and sends the circuit via the URL generated by a quantum circuit simulator such as Quirk or via Python code, such as IBM's Qiskit language.

2. **Queuing:** Submitted circuits are added to a queue, and each user receives a unique identifier for execution. Circuits are scheduled for execution in cycles, where the scheduler waits for the available qubits to fill before scheduling the circuits.

3. **Quantum Policies:** During scheduling, the scheduler combines circuits based on the availability of qubits in the quantum machine. It uses three different scheduling policies, which can be selected by the user.

4. **Combined Circuit Execution:** Once the circuits have been combined, the scheduler schedules the execution of the combined circuit in the quantum machine. The results of this execution are a combination of the results of each individual circuit.

5. **Unscheduling of the results:** These results go through a unscheduling process to divide the results by user, and are stored in a database.

![Python Versions](https://img.shields.io/badge/python-3.9%20|%203.10%20|%203.11%20|%203.12-blue.svg)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](https://github.com/Qcraft-UEx/QCRAFT/blob/main/LICENSE)

## Installation

You can install all the Scheduler dependencies using pip:

```bash
pip install -r requirements.txt
```

## Usage

To initialize the Scheduler you need ports 8081 and 8082 free. The translator uses the port 8081 and the Scheduler the port 8082. If you need to change the ports, refer to the [Configuration](#configuration) section.
Also, it is mandatory to have both AWS and IBM Quantum accounts saved to run the circuits on the cloud.

At first, you need to initialize the mongoDB database.
```bash
cd db
sudo docker compose up --build
```

After initializing the database, you need to start both the translator and the Scheduler on two different terminals because they are both Flask APIs.

```bash
python3 translator.py
```

```bash
python3 scheduler.py
```

Here is a basic example on how to send a Quirk URL to the Scheduler. The Quirk URL will only be accepted in the /url path. You must specify shots and the policy (time, shots, depth, shots_depth, shots_optimized). Also the machine where it will be executed can be specified.
```python
import requests

data = {"url":"https://algassert.com/quirk#circuit={'cols':[['H'],['â€¢','X'],['Measure','Measure']]}" ,"shots":1000, "provider":"ibm", "policy":"time", "machine":'ibm_brisbane'}
requests.post(localhost:8082/url, json = data)
```

Here is a basic example on how to send a GitHub URL to the Scheduler. Using a GitHub URL eliminates the need of a provider in the request. The GitHub URL will only be accepted in the /circuit path. You must specify shots and the policy (time, shots, depth, shots_depth, shots_optimized). Also the machine where it will be executed can be specified.
```python
import requests

data = {"url":"https://raw.githubusercontent.com/user/repo/branch/file.py" ,"shots":10000, "policy":"shots", "machine":'ibm_brisbane'}
requests.post(localhost:8082/circuit, json = data)
```

Here is a basic example on how to send a Qiskit circuit to the Scheduler.
The code must be a string containing the circuit and must be sent to the /code path. You must specify shots and the policy (time, shots, depth, shots_depth, shots_optimized).Also the machine where it will be executed can be specified.

```python
import requests
circuit = "from qiskit import QuantumCircuit, QuantumRegister, ClassicalRegister\nqreg_q = QuantumRegister(2, 'q')\ncreg_c = ClassicalRegister(2, 'c')\n\ncircuit = QuantumCircuit(qreg_q, creg_c)\ncircuit.h(qreg_q[0])\ncircuit.cx(qreg_q[0],qreg_q[1])\ncircuit.measure(qreg_q[0], creg_c[0])\ncircuit.measure(qreg_q[1], creg_c[1])"

data = {"code":circuit ,"shots":10000, "policy":"shots", "machine":'ibm_brisbane'}
requests.post(localhost:8082/code, json = data)
```

### Usage with the quantum executor
To use the quantum executor along with the Scheduler, a test file is provided in /Test/quantum-executor.py
This script creates a Dispatch with the circuit and the backends.

```python
dispatch = {
    "local_aer": [  # Local Aer provider
        "aer_simulator",
        "ibm_brisbane"
    ]
}

executor = QuantumExecutor()
results = executor.generate_dispatch(qiskit_circuit, 1000, dispatch)
```

After that, the circuits are launched to the Scheduler on the selected machines
```python
dispatch_obj = results[0].to_dict()
for provider_name, machines in dispatch_obj.items():
    for machine_name, jobs in machines.items():
        for job in jobs:
            qc = job['circuit']
            shots = job['shots']
        
            # Convert the circuit into a String
            circuit = "from qiskit import QuantumCircuit, QuantumRegister, ClassicalRegister\n"
            circuit += circuit_to_code_ibm(qc)
            
            # Submit this specific job
            machine = 'local' if machine_name == 'aer_simulator' else machine_name
            data = {"code": circuit, "shots": shots, "policy": "shots", "machine": machine}
            scheduler_id = requests.post(url+'code', json=data).text
```

To retrieve the results from the scheduler, fetch the data from the result/ endpoint

```python
scheduler_data = requests.get(url+'result'+f"?id={scheduler_id}")
```

## Configuration

The application can be configured by modifying the `.env` file located at the `/db` folder. This file allows you to change the hostname, port, and other configuration elements crucial for the application's operation.

### Setting up the `.env` file
Open the `.env` file and modify the settings according to your environment and preferences.

### Example `.env` content

```plaintext
# Host configuration
HOST=localhost
PORT=8082

# Translator configuration
TRANSLATOR=localhost
TRANSLATOR_PORT=8081

# Database configuration
DB=localhost
DB_PORT=5432
DB_NAME=name
DB_COLLECTION=collection
DB_USER=username
DB_PASSWORD=password
```


## License
QCRAFT Scheduler is licensed under the [MIT License](https://github.com/Qcraft-UEx/QCRAFT/blob/main/LICENSE)

